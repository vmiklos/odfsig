language: cpp
script:
    - scripts/travis.sh $TRAVIS_ARGS --internal-libs
matrix:
  include:
  - name: "linux gcc release"
    os: linux
    env: TRAVIS_ARGS="--werror" TRAVIS_DEPLOY="y"
  - name: "linux clang debug"
    os: linux
    env: TRAVIS_ARGS="--debug --werror --clang"
  - name: "linux clang asan-ubsan"
    os: linux
    env: TRAVIS_ARGS="--debug --werror --asan-ubsan"
    # See <https://github.com/travis-ci/travis-ci/issues/9033>.
    sudo: true
  - name: "linux valgrind"
    os: linux
    env: TRAVIS_ARGS="--debug --werror --valgrind"
  - name: "linux clang tidy"
    os: linux
    env: TRAVIS_ARGS="--debug --werror --tidy"
  - name: "macos release"
    os: osx
    osx_image: xcode9.3
    env: TRAVIS_ARGS="--werror" TRAVIS_DEPLOY="y"
  - name: "macos debug"
    os: osx
    osx_image: xcode9.3
    env: TRAVIS_ARGS="--debug --werror"
addons:
    apt:
        sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-trusty-7
        packages:
            - g++-7
            - clang-tidy-7
            - valgrind
deploy:
  provider: releases
  api_key:
    secure: GJk8vjoxgvS1DeGUf/druns7D9rkpF9lgalh+Q4ZGb6JCrR3zrJ54rjEyyJw+PMGQl5vKk++wWjLRO8cAMkWlCf0Q6Yftl+1NoVinzaAx7nm68pFLgfbI2t4VYajbeQhJqWm/ttmWD80CpAHCU1tkT6KgvhwJ5b85YG2a/1/SlBWnnp9fvZd4RZg0xCmpqath4xdZE3yL/8DV8j7KMboWsLU2nmbvmTfkyIOZtbCbTKsvMbByij/K/aTpkOFIwH2eKKbTQzzk9+MiwRRMEGm3zBX8+1kXYJzVdM049P+UfTbubkuO/FDFqIK7bvCValxddfiIiczqwouVRLNeKWriPGLTUezlNZXrqBj5B5mcoY9Evdln8K6jsHIafstMAuK7+5Be8C06LU5jiaVUNoZUO9oTdwU9qb0gv8MRmr0Auo3MzqlgELc7rXUAAq7wNikcFUcylSyUnvk0alqyooNfxJ1Qau2i8chegSwZeeu4hpwgPsWJip1dSz+DGhktZ4cRlJ7y2YLVbD4gtI00ec0hcaQ7aRlfXmGnnw4HqyrywP55FGXRz7QtYTSbPF5dmO8xkhiAmGr+ZWFQesKimSsO5I88DFOBMlroEk5of8cZSpBqXWOCUF+FVoSfPRJZHpqs/sZjJ9ar6NYtbpYZmNHdoxIDjXRaC0PKnnNwKvgGuU=
  file_glob: true
  file: workdir/dist/*
  skip_cleanup: true
  on:
    condition:
    - "$TRAVIS_DEPLOY == y"
    tags: true
